function cleanFields() {
    document.getElementById("ra").value = "";
    document.getElementById("subject_code").value = "";
    document.getElementById("semester").value = "";
    document.getElementById("grade").value = "";
    document.getElementById("frequency").value = "";
    document.getElementById("situation").value = "";
    document.getElementById("student_name").value = "";
    document.getElementById("year").value = "";
    document.getElementById("subject_name").value = "";
    document.getElementById("version").value = "";
}

function fill(subject) {
    var optativas = generateOptativas();
    
    var students = xmlDoc.getElementsByTagName("ALUNO");
    var inputGRR = document.getElementById("getGRR").value;
    
    var tag = "COD_ATIV_CURRIC";
    if (subject == "1742" || subject == "1743") {
        tag = "ID_ESTRUTURA_CUR";
    } else if (subject >= "1" && subject <= "9") {
        var num = Number(subject)-1;
        subject = optativas[num].getElementsByTagName("COD_ATIV_CURRIC")[0].childNodes[0].nodeValue;
    }

    for (var i = 0; i < students.length; i++) {
        if (students[i].getElementsByTagName("MATR_ALUNO")[0].childNodes[0].nodeValue == inputGRR) {
            if (students[i].getElementsByTagName(tag)[0].childNodes[0].nodeValue == subject) {        
                document.getElementById("ra").value = students[i].getElementsByTagName("MATR_ALUNO")[0].childNodes[0].nodeValue;
                document.getElementById("subject_code").value = students[i].getElementsByTagName("COD_ATIV_CURRIC")[0].childNodes[0].nodeValue;
                document.getElementById("semester").value = students[i].getElementsByTagName("PERIODO")[0].childNodes[0].nodeValue;
                document.getElementById("grade").value = students[i].getElementsByTagName("MEDIA_FINAL")[0].childNodes[0].nodeValue;
                document.getElementById("frequency").value = students[i].getElementsByTagName("FREQUENCIA")[0].childNodes[0].nodeValue;
                document.getElementById("situation").value = students[i].getElementsByTagName("SITUACAO")[0].childNodes[0].nodeValue;
                document.getElementById("student_name").value = students[i].getElementsByTagName("NOME_ALUNO")[0].childNodes[0].nodeValue;
                document.getElementById("year").value = students[i].getElementsByTagName("ANO")[0].childNodes[0].nodeValue;
                document.getElementById("subject_name").value = students[i].getElementsByTagName("NOME_ATIV_CURRIC")[0].childNodes[0].nodeValue;
                document.getElementById("version").value = students[i].getElementsByTagName("NUM_VERSAO")[0].childNodes[0].nodeValue;
            }
        }
    }    
}

function generateOptativas() {
    var list = [];
    var inputGRR = document.getElementById("getGRR").value;
    var students = xmlDoc.getElementsByTagName("ALUNO");

    for (var i = 0; i < students.length; i++) {
        // if it is the required student and the subject is an 'optativa'
        if (students[i].getElementsByTagName("MATR_ALUNO")[0].childNodes[0].nodeValue == inputGRR &&
             (students[i].getElementsByTagName("DESCR_ESTRUTURA")[0].childNodes[0].nodeValue == "Optativas" ||
              students[i].getElementsByTagName("DESCR_ESTRUTURA")[0].childNodes[0].nodeValue == "Disciplinas de outros cursos" ||
              students[i].getElementsByTagName("DESCR_ESTRUTURA")[0].childNodes[0].nodeValue == "Discipl. de outros currÃ­culos do curso")) {

            // check if this subject was already added to the list
            var alreadyAdded = false;
            for (var j = 0; j < list.length; j++) {
                if (students[i].getElementsByTagName("COD_ATIV_CURRIC")[0].childNodes[0].nodeValue ==
                   list[j].getElementsByTagName("COD_ATIV_CURRIC")[0].childNodes[0].nodeValue) {
                       alreadyAdded = true;
                       list[j] = students[i]; // get most recent entry
                }
            }

            if (!alreadyAdded) {
                list[list.length] = students[i];
            }
        }
    }
    
    // bubble-sort to sort the approved subject before the not approved
    for (var i = 0; i < list.length; i++) {
        for (var j = 1; j < list.length; j++) {
            if (list[j].getElementsByTagName("SIGLA")[0].childNodes[0].nodeValue == "Aprovado" &&
                list[j-1].getElementsByTagName("SIGLA")[0].childNodes[0].nodeValue != "Aprovado") {
                    var tmp = list[j];
                    list[j] = list[i];
                    list[i] = tmp;
                   
            }
        }
    }
    
    return list;
}
